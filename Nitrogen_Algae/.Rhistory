cite(vegan)
library(vegan)
cite("vegan")
?cite
citation("vegan")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
library(rstan)
setwd("~/GitHub/Species-Traits/Nitrogen_Algae")
library(tidyverse)
ammonium <- read.csv("Nh4_Air.csv")
ammonium <- ammonium %>% drop_na()
#same early morning machine problem
ammonium <- ammonium %>%
filter(Rep != 1 & Rep != 15 & Rep != 52) ## not sure about 52 but obvi outlier so check when measured
ammonium <- ammonium %>% group_by(Treat) %>% mutate(med_val = median(NH4)) %>%
mutate(weights = 1/(2/med_val)) ## 2 is 2 mg/L which is the obs error based on guide to YSI
amm  <- ammonium %>%
arrange(Treat, Rep, Day) %>%
group_by(Treat, Rep) %>%
mutate(diff = NH4 / lag(NH4)) %>%
ungroup %>%
mutate(weights_scaled = weights/max(weights), center_NH4 = NH4 - mean(NH4))
### for now remove reps 8 and 50 because don't have all days measured and I don't know how to write stan when they're not even
## and remove day == 1 because those are NA for change
## remove 3 outlier points
amm <- amm[-c(30,108,113),]
amm1 <- amm %>% filter(!is.na(diff))  #%>% filter(Rep != 8) %>% filter(Rep != 50)
## fit in stan
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
amm_stan1 <- list(
"N" = nrow(amm1),
"V" = amm1$Rep,
"y" = amm1$diff
)
fit <- stan(file = "ammonium1.stan",
data = amm_stan1,iter = 4000, control = list(adapt_delta = 0.95, max_treedepth = 15))
fit_sum <- summary(fit)
View(fit_sum$summary)
pairs(fit, pars = c("mu_alpha", "lp_"))
(fit_sum_param <- fit_sum$summary[c(253:268),])
(fit_sum_param <- fit_sum$summary[c(263:268),])
pairs(fit, pars = c("lp__", "mu_alpha"))
pairs(fit, pars = c("lp__", "energy__"))
fit <- stan(file = "ammonium1.stan",
data = amm_stan1,iter = 6000, control = list(adapt_delta = 0.99, max_treedepth = 15))
launch_shinystan(fit)
library(shinystan)
launch_shinystan(fit)
library(brms)
?brm
ff <- brm(diff|weights_scaled ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
ff <- brm(diff|weights ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
ff <- brm(diff|weights(NH4) ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
ff
stancode(ff)
summary(ff)
launch_shinystan(ff)
ff <- brm(diff|weights(weights_scaled) ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
launch_shinystan(ff)
stancode(ff)
stancode(ff)
summary(ff)
amm <-amm[-c(30,108,113),]
amm %>% filter(!is.na(diff))
amm <- amm %>% filter(!is.na(diff))
nrow(amm)
str(ff)
str(ff)$data
g <- str(ff)
ff[[3]]
debug(brm)
ff <- brm(diff|weights(weights_scaled) ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
debug(brmsfit)
str(x)
x$model
sdata
stan_model_args
amm1 <- list(
"N" = nrow(amm),
"Y" = amm$diff,
"weights" = amm$weights_scaled,
"N_1" = length(unique(amm$Rep)),
"M_1" = 1,
"J_1" = amm$Rep,
"Z_1_1" = rep(1,nrow(amm)),
"prior_only" = 0
)
fit <- stan(file = "ammonium.stan",
data = amm_stan1,iter = 2000)
head(amm$diff)
head(amm)
fit <- stan(file = "ammonium.stan",
data = amm1,iter = 2000)
launch_shinystan(fit)
str(fit)
?sampling
gg <- sampling(fit, data= amm1)
mod <- stan_model(file = "ammonium.stan")
gg <- sampling(mod, data= amm1)
