cite(vegan)
library(vegan)
cite("vegan")
?cite
citation("vegan")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
library(rstan)
## trying again to get diff eqs correct
devtools::install_github("parksw3/boms")
## install
devtools::install_github("parksw3/fitode")
## install
devtools::install_github("parksw3/fitode")
install.packages("glmmTMB")
library(glmmTMB)
install.packages("TMB", type = "Source")
install.packages("TMB", type = "source")
install.packages("TMB", type = "Source")
library(glmmTMB)
install.packages("glmmTMB")
library(glmmTMB)
library(lme4)
install.packages("lme4")
library(lme4)
install.packages("lme4")
library(lme4)
## simulate data
#devtools::install_github("parksw3/fitode")
library(fitode)
cammonium = (1-9.4235e-01)
chl_nh4_mod3 <- odemodel(
name = "algal_nit",
model = list(
pred_nh4 ~ -a*pred_chl*(pred_nh4/(k+pred_nh4))+r*death*pred_chl-cammonium,
pred_chl ~ a*pred_chl*(pred_nh4/(k+pred_nh4)) - death*pred_chl
),
observation = list(
nh4 ~ dlnorm(meanlog = log(pred_nh4), sdlog = 0.05),
chl ~ dlnorm(meanlog = log(pred_chl), sdlog = 0.01)
),
initial = list(pred_nh4 ~ pred_nh40 , pred_chl ~ pred_chl0),
par=c("a","k", "r","death", "pred_nh40", "pred_chl0")
)
start3 <- c(a = 0.03,
k = .03,
r = 1,
death = 0.02,
pred_nh40= 15,
pred_chl0 = 40
)
s3 <-  simulate(chl_nh4_mod3,nsim = 5, parms= start3, times = seq(1,40),
solver.opts=list(method="rk4", hini=0.1))
plot(s3$times, s3$chl)
plot(s3$times, s3$nh4)
fit3 <- fitode(
chl_nh4_mod3,
data = s3,
start=start3,
tcol = "times",
solver.opts=list(method="rk4", hini=0.1)
)
coef(fit3)
st <- expand.grid(
a = seq(0.01,0.5,0.04),
k = seq(0.01,0.5,0.04),
r = seq(0.01,1,0.08),
death = seq(0.001,0.05,0.004),
pred_nh40 = 15,
pred_chl0 = 40
)
temp <- data.frame (
a =  0,
k = 0,
r = 0,
death = 0,
pred_nh40 = 15,
pred_chl0 = 40,
lowa = 0,
lowk = 0,
lowr = 0,
lowdeath = 0,
lownh4 = 0,
lowchl = 0,
higha = 0,
highk = 0,
highr = 0,
highdeath = 0,
highnh4 = 0,
highchl = 0,
loglik = 0,
ttime  = 0
)
for(i in 1:nrow(st)) {
newstart <- with(st[i,],
list(
a =  a,
k = k,
r=r,
death = death,
pred_nh40 = pred_nh40,
pred_chl0 = pred_chl0
))
x <- system.time({
tempm <- try((fitode(chl_nh4_mod3, data= s3, start = newstart, tcol = "times",
solver.opts = list(method="rk4", hini=0.1))),silent = TRUE)
if (class(tempm) == "try-error") {
temp[i,] <- "NA"
} else {
temp[i,1:6] <- coef(tempm)
temp[i,7:12] <- confint(tempm)[,2]
temp[i,13:18] <- confint(tempm)[,3]
temp$loglik[i] <- logLik(tempm)
}})
temp$ttime[i] <- x[[3]]
print(i/nrow(st))
}
dat <- temp %>% filter(a != "NA")
library(tidyverse)
dat <- temp %>% filter(a != "NA")
nrow(temp) ## 300
nrow(dat)  ## 18
dat
write.csv(dat, file = "filtered_sim.csv")
write.csv(temp, file = "unfiltered_sim.csv")
getwd()
setwd("~/GitHub/Species-Traits/RDS_compiled")
dat <- read.csv("Master_Data.csv")
str(dat)
dat$treatment <- 0
for (i in 1:nrow(dat)){
if (dat$TankNum[i] ==19| dat$TankNum[i] == 26| dat$TankNum[i] == 41|
dat$TankNum[i] == 45| dat$TankNum[i] ==51| dat$TankNum[i] ==63|
dat$TankNum[i] ==70| dat$TankNum[i] ==71| dat$TankNum[i] ==89|
dat$TankNum[i] ==105| dat$TankNum[i] ==133|dat$TankNum[i] ==135){
dat$treatment[i] <- 1
} else if (dat$TankNum[i] == 14|dat$TankNum[i] ==25|dat$TankNum[i] ==31|
dat$TankNum[i] ==62| dat$TankNum[i] ==94| dat$TankNum[i] ==110|
dat$TankNum[i] ==112| dat$TankNum[i] ==125){
dat$treatment[i] <- 2
} else if (dat$TankNum[i] ==1|dat$TankNum[i] ==8|dat$TankNum[i] ==13|
dat$TankNum[i] ==55|dat$TankNum[i] ==58|dat$TankNum[i] ==66|
dat$TankNum[i] ==82|dat$TankNum[i] ==99|dat$TankNum[i] ==104|
dat$TankNum[i] ==130|dat$TankNum[i] ==138
){
dat$treatment[i] <- 3
} else if (dat$TankNum[i] == 6|dat$TankNum[i] ==29|dat$TankNum[i] ==30|
dat$TankNum[i] ==50|dat$TankNum[i] ==81|dat$TankNum[i] ==93|
dat$TankNum[i] ==111|dat$TankNum[i] ==117|dat$TankNum[i] ==126
) {
dat$treatment[i] <- 4
} else if (dat$TankNum[i] ==7|dat$TankNum[i] ==32|dat$TankNum[i] ==36|
dat$TankNum[i] ==46|dat$TankNum[i] ==49|dat$TankNum[i] ==73|
dat$TankNum[i] ==88|dat$TankNum[i] ==97|dat$TankNum[i] ==107|
dat$TankNum[i] ==119|dat$TankNum[i] ==120|dat$TankNum[i] ==137){
dat$treatment[i] <- 5
} else if (dat$TankNum[i] ==11|dat$TankNum[i] ==22|dat$TankNum[i] ==35|dat$TankNum[i] ==57|
dat$TankNum[i] ==69|dat$TankNum[i] ==79|dat$TankNum[i] ==96|dat$TankNum[i] ==123){
dat$treatment[i] <- 6
} else if (dat$TankNum[i] ==18|dat$TankNum[i] ==24|dat$TankNum[i] ==34|dat$TankNum[i] ==59|
dat$TankNum[i] ==64|dat$TankNum[i] ==86|dat$TankNum[i] ==91|dat$TankNum[i] ==102|
dat$TankNum[i] ==115|dat$TankNum[i] ==122|dat$TankNum[i] ==132|dat$TankNum[i]==139){
dat$treatment[i] <- 7
} else if (dat$TankNum[i] ==15|dat$TankNum[i] ==39|dat$TankNum[i] ==40|dat$TankNum[i] ==76|
dat$TankNum[i] ==77|dat$TankNum[i] ==85|dat$TankNum[i] ==103|dat$TankNum[i] ==129){
dat$treatment[i] <- 8
} else if (dat$TankNum[i] ==21|dat$TankNum[i] ==27|dat$TankNum[i] ==33|
dat$TankNum[i] ==47|dat$TankNum[i] ==52|dat$TankNum[i] ==72|
dat$TankNum[i] ==75|dat$TankNum[i] ==100|dat$TankNum[i] ==101|
dat$TankNum[i] ==106|dat$TankNum[i] ==118|dat$TankNum[i] ==131|dat$TankNum[i] ==140){
dat$treatment[i] <- 9
} else if (dat$TankNum[i] ==12|dat$TankNum[i] ==38|dat$TankNum[i] ==54|
dat$TankNum[i] ==68|dat$TankNum[i] ==74|dat$TankNum[i] ==92|
dat$TankNum[i] ==136){
dat$treatment[i] <- 10
} else if (dat$TankNum[i] ==5|dat$TankNum[i] ==10|dat$TankNum[i] ==23|
dat$TankNum[i] ==44|dat$TankNum[i] ==78|dat$TankNum[i] ==83|
dat$TankNum[i] ==84|dat$TankNum[i] ==87|dat$TankNum[i] ==114|
dat$TankNum[i] ==121|dat$TankNum[i] ==127){
dat$treatment[i] <- 11
} else if (dat$TankNum[i] ==9|dat$TankNum[i] ==28|dat$TankNum[i] ==37|
dat$TankNum[i] ==56|dat$TankNum[i] ==67|dat$TankNum[i] ==90|
dat$TankNum[i] ==113|dat$TankNum[i] ==116|dat$TankNum[i] == 128) {
dat$treatment[i] <- 12
} else if (dat$TankNum[i] == 3|dat$TankNum[i] ==17|dat$TankNum[i] ==42|
dat$TankNum[i] ==43|dat$TankNum[i] ==60|dat$TankNum[i] ==61|
dat$TankNum[i] ==80|dat$TankNum[i] ==95|dat$TankNum[i] ==98|
dat$TankNum[i] ==108){
dat$treatment[i] <- 13
} else if (dat$TankNum[i] ==2|dat$TankNum[i] ==4|dat$TankNum[i] ==16|
dat$TankNum[i] ==20|dat$TankNum[i] ==48|dat$TankNum[i] ==53|dat$TankNum[i] ==65|
dat$TankNum[i] ==109|dat$TankNum[i] ==124|dat$TankNum[i] == 134){
dat$treatment[i] <- 14
}
}
dat1 <- dat %>% filter(treatment == 1)
library(tidyverse)
dat1 <- dat %>% filter(treatment == 1)
str(dat1)
ggplot(dat1, aes(Day, Chl)) + geom_point()
ggplot(dat1, aes(Day, Chl)) + geom_point() + facet_wrap(~.)
ggplot(dat1, aes(Day, Chl)) + geom_point() + facet_wrap(~TankNum)
ggplot(dat1[dat1 <= 200,], aes(Day, Chl)) + geom_point() + facet_wrap(~TankNum)
ggplot(dat1[dat1 < 200,], aes(Day, Chl)) + geom_point() + facet_wrap(~TankNum)
ggplot(dat1[dat1$Chl < 200,], aes(Day, Chl)) + geom_point() + facet_wrap(~TankNum)
ggplot(dat1[dat1$Chl < 200,], aes(Day, Chl)) + geom_point()
ggplot(dat1[dat1$Day < 10,], aes(Day, Chl)) + geom_point()
ggplot(dat1[dat1$Day < 10,], aes(as.factor(Day), Chl)) + geom_point()
ggplot(dat1[dat1$Day < 20,], aes(as.factor(Day), Chl)) + geom_point()
ggplot(dat1, aes(as.factor(Day), Chl)) + geom_point()
ggplot(dat1, aes((Day), Chl)) + geom_point()
length(dat$Day)
length(unique(dat$Day))
View(dat[dat$TankNum == 3 ,])
ggplot(dat1, aes(ExptDay, Chl)) + geom_point()
ggplot(dat1, aes(as.factor(ExptDay), Chl)) + geom_point()
ggplot(dat1, aes(Day, Chl)) + geom_point() + scale_x_continuous(breaks = seq(1, 31, by = 1))
dat1$date <- unite(dat1$Day,dat1$Month, sep = "_")
dat1$date <- unite(as.factor(dat1$Day),dat1$Month, sep = "_")
dat1$date <- unite(as.character(dat1$Day),dat1$Month, sep = "_")
?unite
dat1$date <- unite(dat1, (dat1$Day),dat1$Month, sep = "_")
str(dat1)
dat1$date
dat1$date <- dat1 %>% unite(Day,Month, sep = "_")
date<- dat1 %>% unite(Day,Month, sep = "_")
dat1 = dat %>% filter(treatment == 1)
date<- dat1 %>% unite(Day,Month, sep = "_")
date
date<- dat1 %>% unite(Day,Month, sep = "_", remove = TRUE)
date
date<- dat1 %>% unite("date", Day:Month, sep = "_", remove = TRUE)
date
dat1$date <- date$date
ggplot(dat1, aes(date, Chl)) + geom_point()
broke <- dat1 %>% filter(Chl == "NA")
broke
broke <- dat1 %>% filter(Chl == NA)
broke
View(dat1)
broke <- dat1 %>% filter(is.na(Chl))
broke
dat2 <- dat1 %>% filter(Month == "January" | Month == "February")
dat2
dat2 <- dat2 %>% filter(Day < 10 | Day > 13)
dat2
dat2 <- dat2 %>% filter(Day < 10 | Day > 22)
ggplot(dat2, aes(date,Chl)) + geom_point()
broke <- dat1 %>% filter(is.na(Chl))  ## February 11 and 12
dat2 <- dat1 %>% filter(Month == "January")
ggplot(dat2, aes(date,Chl)) + geom_point()
dat3 <- dat1 %>% filter(Month == "February") %>% filter(Day < 12)
ggplot(dat3, aes(date,Chl)) + geom_point()
ggplot(dat3[dat3$Chl< 1000,], aes(date,Chl)) + geom_point()
