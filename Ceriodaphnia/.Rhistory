cite(vegan)
library(vegan)
cite("vegan")
?cite
citation("vegan")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
library(rstan)
setwd("~/GitHub/Species-Traits/Nitrogen_Algae")
ammonium <- read.csv("Nh4_Air.csv")
ammonium <- ammonium %>% drop_na()
library(tidyverse)
ammonium <- ammonium %>% drop_na()
#same early morning machine problem
ammonium <- ammonium %>%
filter(Rep != 1 & Rep != 15 & Rep != 52) ## not sure about 52 but obvi outlier so check when measured
ammonium <- ammonium %>% group_by(Treat) %>% mutate(med_val = median(NH4)) %>%
mutate(weights = 1/(2/med_val)) ## 2 is 2 mg/L which is the obs error based on guide to YSI
amm  <- ammonium %>%
arrange(Treat, Rep, Day) %>%
group_by(Treat, Rep) %>%
mutate(diff = NH4 / lag(NH4)) %>%
ungroup %>%
mutate(weights_scaled = weights/max(weights), center_NH4 = NH4 - mean(NH4))
library(brms)
ff <- brm(diff|weights(weights_scaled) ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian())
?brm
ff <- brm(diff|weights(weights_scaled) ~ 1+ (1|Rep), data = amm[-c(30,108,113),], family = gaussian(),
control = list(adapt_delta = 0.95))
ff1 <- summary(ff)
launch_shinystan(ff)
with(dat1, plot(nh41, nh4_diff_cc))
str(amm)
with(amm[-c(30,108,113),], plot(Nh4, diff))
with(amm[-c(30,108,113),], plot(NH4, diff))
t <- rstan::extract(ff,permuted = FALSE)
ff1
str(ff1)
launch_shinystan(ff)
samplesb <- posterior_samples(ff, " b_Intercept")
newdat <- data.frame(nh41 = seq(0,25))
b_Intercept
samplesb
samplesb <- posterior_samples(ff)
samplesb
nrow(samplesb)
samplesb <- samplesb %>% select(b_Intercept)
pred_sum <- apply(samplesb, 2, FUN = function (x) quantile(x, c(0.025,0.50,0.975)))
with(amm[-c(30,108,113),], plot(NH4, diff))
lines(seq(0,25), pred_sum[1,])
nrow(pred_sum)
dim(samplesb)
lines(seq(0,25), median(samplesb))
lines(seq(0,25), median(samplesb[,1]))
lines(seq(0,25), rep(median(samplesb[,1]),26))
lines(seq(0,25), rep(quantile(samplesb[,1], c(0.025)),26))
lines(seq(0,25), rep(quantile(samplesb[,1], c(0.975)),26))
mean(samplesb)
mean(samplesb[,1])
medain(samplesb[,1])
median(samplesb[,1])
sd(samplesb[,1])
samples <- posterior_samples(ff)
samplesb <- samples %>% select(b_Intercept)
samples_sigma <- samples %>% select(sigma)
mean(samples_sigma)
samples_sigma
mean(samples_sigma, na.rm = T)
mean(samples_sigma[,1])
sd(samples_sigma[,1])
saveRDS(ff, file = "ammonium.RDS")
setwd("~/GitHub/Species-Traits/Daphnia")
## juvenile daphnia feeding and excretion
source("../transfer_functions.R")
library(tidyverse)
rdatj <- read.csv("Small_Daph_Feeding.csv")
cont <- rdatj %>%
filter(Control.Y.N == "Y") %>%
mutate(Chl_Time_Diff_day = (Chl_Time_Diff/60)*24,Nh4_Time_Diff_day = (Nh4_Time_Dif/60)*24) %>%
mutate(chl_diff =(Chl.1-Chl.2)/Chl_Time_Diff_day, nh4_diff= (Nh4.1-Nh4.2)/Nh4_Time_Diff_day) %>%  # subtract 1 from 2 in chl bc expect 1 to be higher and opp in nh4
group_by(Treatment) %>%
summarize(mean_chl = mean(chl_diff, na.rm = T), mean_nh4 = mean(nh4_diff,na.rm = T)) ## onr row in treatment 3 is all NAs..??
## add mean control avg back to main dataframe
dat <- left_join(rdatj,cont)
dat <- dat %>%
mutate(Chl_Time_Diff_day = (Chl_Time_Diff/60)*24,Nh4_Time_Diff_day = (Nh4_Time_Dif/60)*24) %>%
mutate(chl_diff = (Chl.1-Chl.2)/Chl_Time_Diff_day, nh4_diff = (Nh4.2-Nh4.1)/Nh4_Time_Diff_day) %>%
mutate(chl_diff_cc = (chl_diff-mean_chl)/Num_Daphnia, nh4_diff_cc = (nh4_diff-mean_nh4)/Num_Daphnia)
dat1 <- dat %>% filter(Control.Y.N == "N") %>%
select(Rep.., Treatment,Chl.1,Nh4.1, chl_diff_cc,nh4_diff_cc, Num_Daphnia)
ggplot(dat1, aes(Chl.1,chl_diff_cc)) + geom_point()
## fit in stan
daph_grow_list <- list(
"N" = 75,
"chl" = dat1$Chl.1,
"diff" = dat1$chl_diff_cc
)
fit <- stan(file = "adult_feeding.stan",
data = daph_grow_list)
rstan_options(auto_write = TRUE)
## fit in stan
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
daph_grow_list <- list(
"N" = nrow(dat1),
"chl" = dat1$Chl.1,
"diff" = dat1$chl_diff_cc
)
fit <- stan(file = "adult_feeding.stan",
data = daph_grow_list)
saveRDS(fit, file = "juv_feeding.RDS")
daph_excretion_list <- list(
"N" = nrow(dat1),
"nh4" = dat1$Nh4.1,
"diff" = dat1$nh4_diff_cc
)
fit <- stan(file = "adult_excretion.stan",
data = daph_excretion_list)
saveRDS(fit, file = "juv_exec.RDS")
setwd("~/GitHub/Species-Traits/RDS_compiled")
setwd("~/GitHub/Species-Traits/Ceriodaphnia")
cerio_feed <- read.csv("Ceriodaphnia_Feeding_Nov07_2017.csv")
